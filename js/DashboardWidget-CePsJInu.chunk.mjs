(function(){"use strict";try{if(typeof document<"u"){var t=document.createElement("style");t.appendChild(document.createTextNode(".itop-dashboard[data-v-adce7796]{padding:3px;font-family:var(--font-face);width:100%;max-width:100%;box-sizing:border-box;overflow:hidden}.itop-dashboard__loading[data-v-adce7796],.itop-dashboard__error[data-v-adce7796]{padding:40px 20px;text-align:center}.loading-spinner[data-v-adce7796]{width:32px;height:32px;border:3px solid var(--color-border);border-top-color:var(--color-primary-element);border-radius:50%;animation:spin-adce7796 .8s linear infinite;margin:0 auto 16px}@keyframes spin-adce7796{to{transform:rotate(360deg)}}.itop-dashboard__error .itop-btn[data-v-adce7796]{margin-top:12px}.itop-header[data-v-adce7796]{margin-bottom:20px;text-align:right}.itop-btn-refresh[data-v-adce7796]{padding:8px 5px;background:var(--color-primary-element);color:var(--color-primary-text);border:none;margin:3px;border-radius:6px;font-size:15px;font-weight:500;cursor:pointer;transition:background .2s;display:inline-flex;align-items:center;justify-content:center;gap:6px}.itop-btn-refresh[data-v-adce7796]:hover:not(:disabled){background:var(--color-primary-element-hover)}.itop-btn-refresh[data-v-adce7796]:disabled{opacity:.6;cursor:not-allowed}.itop-btn-refresh .spinner[data-v-adce7796]{display:inline-block;animation:spin-adce7796 1s linear infinite}.itop-btn-new-ticket[data-v-adce7796]{padding:8px 5px;background:var(--color-primary-element);color:var(--color-primary-text);border:none;margin:3px;border-radius:6px;font-size:15px;font-weight:500;cursor:pointer;transition:background .2s;display:inline-flex;align-items:center;justify-content:center;gap:6px;text-decoration:none}.itop-btn-new-ticket[data-v-adce7796]:hover{background:var(--color-primary-element-hover)}.itop-btn-new-ticket span[data-v-adce7796]{font-size:18px;line-height:1}.itop-empty-state[data-v-adce7796]{text-align:center;padding:40px 20px}.itop-empty-state__icon[data-v-adce7796]{font-size:48px;margin-bottom:16px}.itop-empty-state h3[data-v-adce7796]{margin:0 0 8px;font-size:18px;font-weight:600}.itop-empty-state p[data-v-adce7796]{color:var(--color-text-maxcontrast);margin:0}.itop-section[data-v-adce7796]{margin-bottom:20px;max-width:100%;overflow:hidden}.itop-section__title[data-v-adce7796]{font-size:16px;font-weight:600;margin:0 0 12px;color:var(--color-main-text)}.itop-status-grid[data-v-adce7796]{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:8px;max-width:100%}.itop-status-card[data-v-adce7796]{background:var(--color-main-background);border:1px solid var(--color-border);border-radius:6px;padding:12px 8px;text-align:center;transition:all .2s;min-width:0}.itop-status-card[data-v-adce7796]:hover{box-shadow:0 2px 8px #0000001a;transform:translateY(-2px)}.status-icon[data-v-adce7796]{font-size:24px;margin-bottom:8px}.status-count[data-v-adce7796]{font-size:24px;font-weight:700;color:var(--color-main-text);line-height:1;margin-bottom:4px}.status-label[data-v-adce7796]{font-size:11px;color:var(--color-text-maxcontrast);text-transform:capitalize;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.itop-ticket-list[data-v-adce7796]{border:1px solid var(--color-border);border-radius:8px;overflow:hidden;width:100%;max-width:100%;box-sizing:border-box}.itop-ticket-item[data-v-adce7796]{display:flex;gap:12px;padding:12px 16px;border-bottom:1px solid var(--color-border);width:100%;max-width:100%;box-sizing:border-box;overflow:hidden;cursor:pointer}.itop-ticket-item[data-v-adce7796]:last-child{border-bottom:none}.ticket-icon[data-v-adce7796]{font-size:20px;line-height:1.4}.ticket-content[data-v-adce7796]{flex:1;min-width:0;max-width:100%;overflow:hidden}.ticket-title[data-v-adce7796]{display:block;font-weight:500;color:var(--color-main-text);margin-bottom:4px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ticket-ref[data-v-adce7796]{color:var(--color-text-maxcontrast);font-weight:600}.ticket-meta[data-v-adce7796]{font-size:12px;color:var(--color-text-maxcontrast);display:flex;gap:6px;flex-wrap:wrap}.ticket-meta span[data-v-adce7796]{white-space:nowrap}.priority-critical[data-v-adce7796]{color:#bf2600;font-weight:600}.priority-high[data-v-adce7796]{color:#ff8b00;font-weight:600}.priority-medium[data-v-adce7796]{color:#ffab00;font-weight:600}.priority-low[data-v-adce7796]{color:#36b37e;font-weight:600}.itop-empty[data-v-adce7796]{padding:20px;text-align:center;color:var(--color-text-maxcontrast);background:var(--color-background-hover);border-radius:8px}.itop-btn[data-v-adce7796]{padding:10px 5px;border-radius:6px;font-size:15px;font-weight:500;margin:3px;text-decoration:none;text-align:center;cursor:pointer;border:1px solid var(--color-border);transition:all .2s;display:flex;align-items:center;justify-content:center;flex:1}.itop-btn-primary[data-v-adce7796]{background:var(--color-primary-element);color:var(--color-primary-text);border-color:var(--color-primary-element)}.itop-btn-primary[data-v-adce7796]:hover{background:var(--color-primary-element-hover)}.itop-btn-secondary[data-v-adce7796]{background:var(--color-main-background);color:var(--color-main-text)}.itop-btn-secondary[data-v-adce7796]:hover{background:var(--color-background-hover)}@media (max-width: 480px){.itop-dashboard[data-v-adce7796]{padding:8px}.itop-ticket-item[data-v-adce7796]{gap:8px;padding:8px 12px}.ticket-meta[data-v-adce7796]{flex-direction:column;gap:4px;align-items:flex-start}.itop-actions[data-v-adce7796]{flex-direction:column;gap:8px}.itop-btn[data-v-adce7796],.itop-btn-refresh[data-v-adce7796],.itop-btn-new-ticket[data-v-adce7796]{width:100%;justify-content:center}}@media (min-width: 481px) and (max-width: 768px){.itop-actions[data-v-adce7796]{flex-wrap:wrap;gap:8px}.ticket-meta[data-v-adce7796]{gap:8px}}")),document.head.appendChild(t)}}catch(a){console.error("vite-plugin-css-injected-by-js",a)}})();
/*! third party licenses: js/vendor.LICENSE.txt */
import{d as c,_ as l,e as d}from"./index-D95ThKSd.chunk.mjs";import{n as p}from"./_plugin-vue2_normalizer-9Vl1xU4X.chunk.mjs";import"./index-vg7q3Iku.chunk.mjs";const u={name:"DashboardWidget",props:{title:{type:String,default:""}},data(){return{loading:!0,refreshing:!1,error:"",counts:{},byStatus:{},tickets:{},itopUrl:"",displayName:this.title||"iTop"}},computed:{totalTickets(){const t=this.byStatus.open||0,e=this.byStatus.escalated||0,s=this.byStatus.pending||0,i=this.byStatus.resolved||0;return t+e+s+i},recentTickets(){const t=[];["open","escalated","pending","resolved"].forEach(s=>{this.tickets[s]&&t.push(...this.tickets[s])}),t.sort((s,i)=>{const a=s.last_update||s.start_date||"";return(i.last_update||i.start_date||"").localeCompare(a)});const e=t.slice(0,4);return console.log("[DashboardWidget] recentTickets:",e),e},viewAllUrl(){const t=this.getItopUrl();return t?"".concat(t,"/pages/UI.php"):"#"},newTicketUrl(){const t=this.getItopUrl();return t?"".concat(t,"/pages/exec.php/browse/services?exec_module=itop-portal-base&exec_page=index.php&portal_id=itop-portal"):"#"}},mounted(){this.refresh()},methods:{t:c,iconPath(t){return window.location.origin+"/apps/integration_itop/img/"+t},getTicketIcon(t){const e=(t.status||"").toLowerCase(),s=t.type==="Incident",i=s?"incident":"user-request";return e==="closed"||e==="resolved"?this.iconPath("".concat(i,"-closed.svg")):e.includes("escalated")?this.iconPath("".concat(i,"-escalated.svg")):e==="pending"||e.includes("deadline")?this.iconPath("".concat(i,"-deadline.svg")):s&&e==="new"?this.iconPath("incident-red.svg"):this.iconPath("".concat(i,".svg"))},async refresh(){var t,e;if(!this.refreshing)try{this.refreshing=!0,this.loading||(this.loading=!0);const s=l("/apps/integration_itop/dashboard"),i=(await d.get(s)).data||{};if(i.error)throw new Error(i.error);Object.keys(i.counts||{}).forEach(a=>{this.$set(this.counts,a,i.counts[a])}),Object.keys(i.stats&&i.stats.by_status||{}).forEach(a=>{this.$set(this.byStatus,a,i.stats.by_status[a])}),Object.keys(i.tickets||{}).forEach(a=>{this.$set(this.tickets,a,i.tickets[a])}),this.itopUrl=i.itop_url||"",this.displayName=i.display_name||this.title||"iTop",this.error="",this.loading=!1}catch(s){this.error=((e=(t=s.response)==null?void 0:t.data)==null?void 0:e.error)||this.t("integration_itop","Failed to refresh dashboard"),this.loading=!1}finally{this.refreshing=!1}},priorityLevel(t){if(!t)return"low";const e=t.toLowerCase();return e.includes("critical")||e==="4"?"critical":e.includes("high")||e==="3"?"high":e.includes("medium")||e==="2"?"medium":"low"},getStatusEmoji(t){const e=(t||"").toLowerCase();return e==="new"?"üÜï":e==="assigned"?"üë•":e==="pending"?"‚è≥":e==="escalated_tto"||e==="escalated_ttr"?"‚ö†Ô∏è":e==="resolved"?"‚úÖ":e==="closed"?"‚òëÔ∏è":e==="waiting_for_approval"?"‚è≥":e==="approved"?"‚úÖ":e==="rejected"?"‚ùå":"‚ö™"},getPriorityEmoji(t){if(!t)return"üîµ";const e=String(t).toLowerCase();return e.includes("1")||e.includes("critical")?"üî¥":e.includes("2")||e.includes("high")?"üü†":e.includes("3")||e.includes("medium")?"üü°":e.includes("4")||e.includes("low")?"üü¢":"‚ö™"},getStatusLabel(t){const e=(t||"").toLowerCase();return e==="new"?"New":e==="assigned"?"Assigned":e==="pending"?"Pending":e==="escalated_tto"?"Escalated TTO":e==="escalated_ttr"?"Escalated TTR":e==="resolved"?"Resolved":e==="closed"?"Closed":e==="waiting_for_approval"?"Waiting for approval":e==="approved"?"Approved":e==="rejected"?"Rejected":t||"Unknown"},getPriorityLabel(t){if(!t)return"Unknown priority";const e=String(t).toLowerCase();return e.includes("1")||e.includes("critical")?"Priority 1 - Critical":e.includes("2")||e.includes("high")?"Priority 2 - High":e.includes("3")||e.includes("medium")?"Priority 3 - Medium":e.includes("4")||e.includes("low")?"Priority 4 - Low":"Priority ".concat(t)},getTicketTooltip(t){const e=t.ref||"N/A",s=t.start_date||"N/A",i=t.last_update||"N/A",a=t.title||"Untitled ticket";let r=t.description||"No description";return r=r.replace(/<br\s*\/?>/gi,"\n").replace(/<\/p>/gi,"\n").replace(/<p[^>]*>/gi,"").replace(/<[^>]+>/g,"").trim(),"Ticket: ".concat(e,"\nCreated: ").concat(s,"\nUpdated: ").concat(i,"\n-------------------\nTitle: ").concat(a,"\nDescription:\n").concat(r)},formatRelativeTime(t){if(!t)return"";try{const e=new Date(t),s=new Date-e,i=Math.floor(s/1e3),a=Math.floor(i/60),r=Math.floor(a/60),o=Math.floor(r/24),n=Math.floor(o/7);return i<60?"just now":a===1?"1 min ago":a<60?"".concat(a," min ago"):r===1?"1 hour ago":r<24?"".concat(r," hours ago"):o===1?"1 day ago":o<7?"".concat(o," days ago"):n===1?"1 week ago":n<4?"".concat(n," weeks ago"):e.toLocaleDateString()}catch(e){return t}},getItopUrl(){return this.itopUrl||""},openSearch(){const t=document.querySelector('input[type="search"].unified-search__input');t&&t.focus()},openTicket(t){t&&window.open(t,"_blank","noopener,noreferrer")}}};var _=function(){var t=this,e=t._self._c;return e("div",{ref:"dashboard",staticClass:"itop-dashboard",attrs:{role:"region","aria-label":t.t("integration_itop","Dashboard")}},[t.loading?e("div",{staticClass:"itop-dashboard__loading"},[e("div",{staticClass:"loading-spinner"}),e("p",[t._v(t._s(t.t("integration_itop","Loading dashboard...")))])]):t.error?e("div",{staticClass:"itop-dashboard__error"},[e("p",[t._v(t._s(t.error))]),e("button",{staticClass:"itop-btn",on:{click:t.refresh}},[t._v(" "+t._s(t.t("integration_itop","Retry"))+" ")])]):e("div",{staticClass:"itop-dashboard__content"},[t.totalTickets>0?[e("div",{staticClass:"itop-header-compact"},[e("h3",{staticClass:"itop-header-compact__title"},[t._v(" "+t._s(t.totalTickets)+" "+t._s(t.t("integration_itop",t.totalTickets===1?"Ticket":"Tickets"))+" ")]),e("div",{staticClass:"itop-status-badges"},[t.byStatus.open?e("span",{staticClass:"status-badge status-open"},[t._v(" "+t._s(t.byStatus.open)+" "+t._s(t.t("integration_itop","Open"))+" ")]):t._e(),t.byStatus.escalated?e("span",{staticClass:"status-badge status-escalated"},[t._v(" "+t._s(t.byStatus.escalated)+" "+t._s(t.t("integration_itop","Escalated"))+" ")]):t._e(),t.byStatus.pending?e("span",{staticClass:"status-badge status-pending"},[t._v(" "+t._s(t.byStatus.pending)+" "+t._s(t.t("integration_itop","Pending"))+" ")]):t._e(),t.byStatus.resolved?e("span",{staticClass:"status-badge status-resolved"},[t._v(" "+t._s(t.byStatus.resolved)+" "+t._s(t.t("integration_itop","Resolved"))+" ")]):t._e()])]),t.recentTickets.length===0?e("div",{staticClass:"itop-empty"},[t._v(" "+t._s(t.t("integration_itop","No recent tickets"))+" ")]):e("div",{staticClass:"itop-ticket-list"},t._l(t.recentTickets,function(s){return e("div",{key:s.type+"-"+s.id,staticClass:"itop-ticket-item",on:{click:function(i){return t.openTicket(s.url)}}},[e("img",{staticClass:"ticket-svg",attrs:{src:t.getTicketIcon(s),alt:""}}),e("div",{staticClass:"ticket-content"},[e("div",{staticClass:"ticket-title",attrs:{title:t.getTicketTooltip(s)}},[e("span",{staticClass:"ticket-emoji",attrs:{title:t.getStatusLabel(s.status)}},[t._v(t._s(t.getStatusEmoji(s.status)))]),s.ref?e("span",{staticClass:"ticket-ref"},[t._v(t._s(s.ref)+":")]):t._e(),t._v(" "+t._s(s.title||t.t("integration_itop","Untitled ticket"))+" ")]),e("div",{staticClass:"ticket-meta"},[e("span",{staticClass:"ticket-status"},[t._v(t._s(s.operational_status||s.status))]),e("span",{staticClass:"ticket-meta-separator"},[t._v("‚Ä¢")]),e("span",{staticClass:"ticket-priority-emoji",attrs:{title:t.getPriorityLabel(s.priority)}},[t._v(t._s(t.getPriorityEmoji(s.priority)))]),s.last_update?e("span",{staticClass:"ticket-meta-separator"},[t._v("‚Ä¢")]):t._e(),s.last_update?e("span",{staticClass:"ticket-time",attrs:{title:"Last updated: "+s.last_update}},[t._v(" üïê "+t._s(t.formatRelativeTime(s.last_update))+" ")]):t._e()])])])}),0)]:t.totalTickets===0&&!t.loading?e("div",{staticClass:"itop-empty-state"},[e("div",{staticClass:"itop-empty-state__icon"},[e("img",{staticClass:"empty-state-svg",attrs:{src:t.iconPath("ticket.svg"),alt:""}})]),e("h3",[t._v(t._s(t.t("integration_itop","No tickets found")))]),e("p",[t._v(t._s(t.t("integration_itop","You have no open tickets at the moment")))])]):t._e(),e("div",{staticClass:"itop-actions"},[e("button",{staticClass:"itop-btn itop-btn-refresh",attrs:{disabled:t.refreshing},on:{click:t.refresh}},[t.refreshing?e("span",{staticClass:"spinner"},[t._v("‚Üª")]):e("span",[t._v("‚Üª")]),t._v(" "+t._s(t.t("integration_itop","Refresh"))+" ")]),e("a",{staticClass:"itop-btn itop-btn-new-ticket",attrs:{href:t.newTicketUrl,target:"_blank",rel:"noopener noreferrer"}},[e("span",[t._v("+")]),t._v(" "+t._s(t.t("integration_itop","New Ticket"))+" ")])])],2)])},g=[],h=p(u,_,g,!1,null,"adce7796");const f=h.exports;export{f as default};
//# sourceMappingURL=DashboardWidget-CePsJInu.chunk.mjs.map
