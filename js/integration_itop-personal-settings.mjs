/*! third party licenses: js/vendor.LICENSE.txt */
(function(){const g=window.t||function(l,m){return m};document.addEventListener("DOMContentLoaded",function(){const l=document.getElementById("itop-save"),m=document.getElementById("itop-personal-token"),v=document.getElementById("itop-notification-enabled"),u=document.getElementById("itop-result");if(!l||!m||!u)return;v&&v.addEventListener("change",function(){const e=document.getElementById("notification-settings-content");e&&(v.checked?e.style.display="":e.style.display="none")});const y=document.getElementById("itop-personal-connection-status");y&&y.classList.contains("success")&&C();function C(){T(),E()}function T(){const e=document.getElementById("itop-personal-user-value"),o=document.getElementById("itop-personal-user-info");!e||!o||fetch(OC.generateUrl("/apps/integration_itop/user-info"),{method:"GET",headers:{requesttoken:OC.requestToken}}).then(t=>t.json()).then(t=>{if(t.error)e.textContent="Error: "+t.error;else{const i=t.name||"Unknown User",s=t.email||"",a=t.organization||"";e.innerHTML='\n                        <div class="itop-status-user-info-simple">\n                            <div class="itop-status-user-name">'.concat(i,"</div>\n                            ").concat(s?'<div class="itop-status-user-email">'.concat(s,"</div>"):"","\n                            ").concat(a?'<div class="itop-status-user-org">'.concat(a,"</div>"):"","\n                        </div>\n                    "),o.className="itop-personal-status-card connected"}}).catch(()=>{e.textContent="Error loading"})}function L(e){const o=document.getElementById("itop-personal-connection-status"),t=document.getElementById("itop-personal-connection-value");o&&t&&(o.className="itop-personal-status-card itop-connection-status success",t.textContent="Configured");const i=document.getElementById("itop-personal-user-info"),s=document.getElementById("itop-personal-user-value");if(i&&s&&e){i.className="itop-personal-status-card connected";const a=e.name||"Unknown User",r=e.email||"",f=e.organization||"";s.innerHTML='\n                    <div class="itop-status-user-info-simple">\n                        <div class="itop-status-user-name">'.concat(a,"</div>\n                        ").concat(r?'<div class="itop-status-user-email">'.concat(r,"</div>"):"","\n                        ").concat(f?'<div class="itop-status-user-org">'.concat(f,"</div>"):"","\n                    </div>\n                ")}E()}function E(){const e=document.getElementById("itop-personal-tickets-value"),o=document.getElementById("itop-personal-tickets-info");!e||!o||(e.textContent="Loading...",fetch(OC.generateUrl("/apps/integration_itop/tickets/count"),{method:"GET",headers:{requesttoken:OC.requestToken}}).then(t=>t.json()).then(t=>{if(t.error)e.textContent="Error: "+t.error;else if(typeof t.incidents<"u"&&typeof t.requests<"u"){const i=t.incidents||0,s=t.requests||0,a=i+s;e.innerHTML='\n                        <div class="itop-ticket-counts">\n                            <div>'.concat(g("integration_itop","Incident(s):"),' <span class="itop-count-large">').concat(i,"</span></div>\n                            <div>").concat(g("integration_itop","Request(s):"),' <span class="itop-count-large">').concat(s,"</span></div>\n                        </div>\n                    "),a>0?o.className="itop-personal-status-card has-tickets connected":o.className="itop-personal-status-card connected"}else e.innerHTML='\n                        <div class="itop-ticket-counts">\n                            <div>'.concat(g("integration_itop","Incident(s):"),' <span class="itop-count-large">0</span></div>\n                            <div>').concat(g("integration_itop","Request(s):"),' <span class="itop-count-large">0</span></div>\n                        </div>\n                    ')}).catch(()=>{e.textContent="Error loading"}))}function p(e,o=!1,t=null){if(t&&L(t),o){u.innerHTML="",u.className="error";const i=document.createElement("div");i.className="result-main";const s=document.createElement("span");s.className="icon icon-error";const a=document.createElement("span");a.className="message",a.textContent=e,i.appendChild(s),i.appendChild(a);const r=document.createElement("button");r.className="close-button",r.innerHTML="×",r.title="Close",r.addEventListener("click",()=>{u.classList.add("hidden")}),i.appendChild(r),u.appendChild(i),u.classList.remove("hidden")}else OC.Notification&&OC.Notification.showTemporary&&OC.Notification.showTemporary(e+" ✅"),m.value="",u.classList.add("hidden")}l.addEventListener("click",function(){u.classList.add("hidden");const e=m.value.trim(),o=v.checked?"1":"0",t=document.getElementById("itop-search-enabled");l.disabled=!0;const i=l.innerHTML;l.innerHTML='<span class="icon">⏳</span> Saving...';const s={notification_enabled:o,search_enabled:t&&t.checked?"1":"0"};e&&e.trim()!==""&&(s.personal_token=e);const a=document.querySelectorAll('input[name="user_ci_class"]');if(a.length>0){const n=[];a.forEach(function(c){c.checked||n.push(c.value)}),s.disabled_ci_classes=n}const r=document.querySelectorAll("input[data-notification-type]");if(r.length>0){const n=[],c=[];r.forEach(function(h){if(!h.checked){const _=h.dataset.notificationType,k=h.dataset.notification;_==="portal"?n.push(k):_==="agent"&&c.push(k)}}),n.length>0?s.disabled_portal_notifications=n:s.disabled_portal_notifications=[],c.length>0?s.disabled_agent_notifications=c:s.disabled_agent_notifications=[]}const f=document.getElementById("notification-check-interval");if(f){const n=parseInt(f.value);if(isNaN(n)||n<5||n>1440){l.disabled=!1,l.innerHTML=i;let c="Invalid notification check interval. ";isNaN(n)?c+="Please enter a valid number.":n<5?c+="Minimum value is 5 minutes.":c+="Maximum value is 1440 minutes (24 hours).",p(c,!0);return}s.notification_check_interval=n}const d=new XMLHttpRequest;d.open("PUT",OC.generateUrl("/apps/integration_itop/config")),d.setRequestHeader("requesttoken",OC.requestToken),d.setRequestHeader("Content-Type","application/json"),d.onreadystatechange=function(){if(d.readyState===4)if(l.disabled=!1,l.innerHTML=i,d.status===200)try{const n=JSON.parse(d.responseText);n.person_id_configured&&n.user_info?p(n.message||"Configuration successful!",!1,n.user_info):p(n.message||"Settings saved",!1)}catch(n){p("Failed to parse server response",!0)}else try{const n=d.responseText?JSON.parse(d.responseText):{},c=n.error||n.message||"Failed to save settings";p(c,!0)}catch(n){p("Server error (status: "+d.status+")",!0)}},d.send(JSON.stringify(s))})})})();
//# sourceMappingURL=integration_itop-personal-settings.mjs.map
