/*! third party licenses: js/vendor.LICENSE.txt */
(function(){const p=window.t||function(c,l){return l};document.addEventListener("DOMContentLoaded",function(){const c=document.getElementById("itop-save"),l=document.getElementById("itop-personal-token"),v=document.getElementById("itop-notification-enabled"),r=document.getElementById("itop-result");if(!c||!l||!r)return;const m=document.getElementById("itop-personal-connection-status");m&&m.classList.contains("success")&&f();function f(){h(),g()}function h(){const t=document.getElementById("itop-personal-user-value"),a=document.getElementById("itop-personal-user-info");!t||!a||fetch(OC.generateUrl("/apps/integration_itop/user-info"),{method:"GET",headers:{requesttoken:OC.requestToken}}).then(e=>e.json()).then(e=>{if(e.error)t.textContent="Error: "+e.error;else{const o=e.name||"Unknown User",i=e.email||"",n=e.organization||"";t.innerHTML='\n                        <div class="itop-status-user-info-simple">\n                            <div class="itop-status-user-name">'.concat(o,"</div>\n                            ").concat(i?'<div class="itop-status-user-email">'.concat(i,"</div>"):"","\n                            ").concat(n?'<div class="itop-status-user-org">'.concat(n,"</div>"):"","\n                        </div>\n                    "),a.className="itop-personal-status-card connected"}}).catch(()=>{t.textContent="Error loading"})}function E(t){const a=document.getElementById("itop-personal-connection-status"),e=document.getElementById("itop-personal-connection-value");a&&e&&(a.className="itop-personal-status-card itop-connection-status success",e.textContent="Configured");const o=document.getElementById("itop-personal-user-info"),i=document.getElementById("itop-personal-user-value");if(o&&i&&t){o.className="itop-personal-status-card connected";const n=t.name||"Unknown User",s=t.email||"",d=t.organization||"";i.innerHTML='\n                    <div class="itop-status-user-info-simple">\n                        <div class="itop-status-user-name">'.concat(n,"</div>\n                        ").concat(s?'<div class="itop-status-user-email">'.concat(s,"</div>"):"","\n                        ").concat(d?'<div class="itop-status-user-org">'.concat(d,"</div>"):"","\n                    </div>\n                ")}g()}function g(){const t=document.getElementById("itop-personal-tickets-value"),a=document.getElementById("itop-personal-tickets-info");!t||!a||(t.textContent="Loading...",fetch(OC.generateUrl("/apps/integration_itop/tickets/count"),{method:"GET",headers:{requesttoken:OC.requestToken}}).then(e=>e.json()).then(e=>{if(e.error)t.textContent="Error: "+e.error;else if(typeof e.incidents<"u"&&typeof e.requests<"u"){const o=e.incidents||0,i=e.requests||0,n=o+i;t.innerHTML='\n                        <div class="itop-ticket-counts">\n                            <div>'.concat(p("integration_itop","Incident(s):"),' <span class="itop-count-large">').concat(o,"</span></div>\n                            <div>").concat(p("integration_itop","Request(s):"),' <span class="itop-count-large">').concat(i,"</span></div>\n                        </div>\n                    "),n>0?a.className="itop-personal-status-card has-tickets connected":a.className="itop-personal-status-card connected"}else t.innerHTML='\n                        <div class="itop-ticket-counts">\n                            <div>'.concat(p("integration_itop","Incident(s):"),' <span class="itop-count-large">0</span></div>\n                            <div>').concat(p("integration_itop","Request(s):"),' <span class="itop-count-large">0</span></div>\n                        </div>\n                    ')}).catch(()=>{t.textContent="Error loading"}))}function u(t,a=!1,e=null){if(e&&E(e),a){r.innerHTML="",r.className="error";const o=document.createElement("div");o.className="result-main";const i=document.createElement("span");i.className="icon icon-error";const n=document.createElement("span");n.className="message",n.textContent=t,o.appendChild(i),o.appendChild(n);const s=document.createElement("button");s.className="close-button",s.innerHTML="×",s.title="Close",s.addEventListener("click",()=>{r.classList.add("hidden")}),o.appendChild(s),r.appendChild(o),r.classList.remove("hidden")}else OC.Notification&&OC.Notification.showTemporary&&OC.Notification.showTemporary(t+" ✅"),l.value="",r.classList.add("hidden")}c.addEventListener("click",function(){r.classList.add("hidden");const t=l.value.trim(),a=v.checked?"1":"0";c.disabled=!0;const e=c.innerHTML;c.innerHTML='<span class="icon">⏳</span> Saving...';const o={notification_enabled:a};t&&t.trim()!==""&&(o.personal_token=t);const i=document.querySelectorAll('input[name="user_ci_class"]');if(i.length>0){const s=[];i.forEach(function(d){d.checked||s.push(d.value)}),o.disabled_ci_classes=s}const n=new XMLHttpRequest;n.open("PUT",OC.generateUrl("/apps/integration_itop/config")),n.setRequestHeader("requesttoken",OC.requestToken),n.setRequestHeader("Content-Type","application/json"),n.onreadystatechange=function(){if(n.readyState===4)if(c.disabled=!1,c.innerHTML=e,n.status===200)try{const s=JSON.parse(n.responseText);s.person_id_configured&&s.user_info?u(s.message||"Configuration successful!",!1,s.user_info):u(s.message||"Settings saved",!1)}catch(s){u("Failed to parse server response",!0)}else try{const s=n.responseText?JSON.parse(n.responseText):{},d=s.error||s.message||"Failed to save settings";u(d,!0)}catch(s){u("Server error (status: "+n.status+")",!0)}},n.send(JSON.stringify(o))})})})();
//# sourceMappingURL=integration_itop-personal-settings.mjs.map
