(function(){"use strict";try{if(typeof document<"u"){var a=document.createElement("style");a.appendChild(document.createTextNode(".itop-dashboard[data-v-22aaa6ac]{padding:3px;font-family:var(--font-face);width:100%;max-width:100%;box-sizing:border-box;overflow:hidden}.itop-dashboard__loading[data-v-22aaa6ac],.itop-dashboard__error[data-v-22aaa6ac]{padding:40px 20px;text-align:center}.loading-spinner[data-v-22aaa6ac]{width:32px;height:32px;border:3px solid var(--color-border);border-top-color:var(--color-primary-element);border-radius:50%;animation:spin-22aaa6ac .8s linear infinite;margin:0 auto 16px}@keyframes spin-22aaa6ac{to{transform:rotate(360deg)}}.itop-dashboard__error .itop-btn[data-v-22aaa6ac]{margin-top:12px}.itop-header[data-v-22aaa6ac]{margin-bottom:20px;text-align:right}.itop-btn-refresh[data-v-22aaa6ac]{padding:8px 5px;background:var(--color-primary-element);color:var(--color-primary-text);border:none;margin:3px;border-radius:6px;font-size:15px;font-weight:500;cursor:pointer;transition:all .2s ease;display:inline-flex;align-items:center;justify-content:center;gap:6px}.itop-btn-refresh[data-v-22aaa6ac]:hover:not(:disabled){background:var(--color-primary-element-hover);transform:translateY(-1px);box-shadow:0 2px 4px #0000001a}.itop-btn-refresh[data-v-22aaa6ac]:disabled{opacity:.6;cursor:not-allowed}.itop-btn-refresh .spinner[data-v-22aaa6ac]{display:inline-block;animation:spin-22aaa6ac 1s linear infinite}.itop-btn-new-ticket[data-v-22aaa6ac]{padding:8px 5px;background:var(--color-primary-element);color:var(--color-primary-text);border:none;margin:3px;border-radius:6px;font-size:15px;font-weight:500;cursor:pointer;transition:all .2s ease;display:inline-flex;align-items:center;justify-content:center;gap:6px;text-decoration:none}.itop-btn-new-ticket[data-v-22aaa6ac]:hover{background:var(--color-primary-element-hover);transform:translateY(-1px);box-shadow:0 2px 4px #0000001a}.itop-btn-new-ticket span[data-v-22aaa6ac]{font-size:18px;line-height:1}.itop-empty-state[data-v-22aaa6ac]{text-align:center;padding:40px 20px}.itop-empty-state__icon[data-v-22aaa6ac]{font-size:48px;margin-bottom:16px}.itop-empty-state h3[data-v-22aaa6ac]{margin:0 0 8px;font-size:18px;font-weight:600}.itop-empty-state p[data-v-22aaa6ac]{color:var(--color-text-maxcontrast);margin:0}.itop-section[data-v-22aaa6ac]{margin-bottom:20px;max-width:100%;overflow:hidden}.itop-section__title[data-v-22aaa6ac]{font-size:16px;font-weight:600;margin:0 0 12px;color:var(--color-main-text)}.itop-status-grid[data-v-22aaa6ac]{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:8px;max-width:100%}.itop-status-card[data-v-22aaa6ac]{background:var(--color-main-background);border:1px solid var(--color-border);border-radius:6px;padding:12px 8px;text-align:center;transition:all .2s;min-width:0}.itop-status-card[data-v-22aaa6ac]:hover{box-shadow:0 2px 8px #0000001a;transform:translateY(-2px)}.status-icon[data-v-22aaa6ac]{font-size:24px;margin-bottom:8px}.status-count[data-v-22aaa6ac]{font-size:24px;font-weight:700;color:var(--color-main-text);line-height:1;margin-bottom:4px}.status-label[data-v-22aaa6ac]{font-size:11px;color:var(--color-text-maxcontrast);text-transform:capitalize;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.itop-ticket-list[data-v-22aaa6ac]{border:1px solid var(--color-border);border-radius:8px;overflow:hidden;width:100%;max-width:100%;box-sizing:border-box}.itop-ticket-item[data-v-22aaa6ac]{display:flex;gap:12px;padding:12px 16px;background:var(--color-main-background);border-bottom:1px solid var(--color-border);width:100%;max-width:100%;box-sizing:border-box;overflow:hidden;cursor:pointer;transition:all .2s ease;outline:none}.itop-ticket-item[data-v-22aaa6ac]:hover{background:var(--color-primary-light);transform:translateY(-1px);box-shadow:0 2px 4px #0000001a;outline:none;border-bottom-color:transparent!important;border-color:transparent!important}.itop-ticket-item[data-v-22aaa6ac]:last-child{border-bottom:none}.ticket-icon[data-v-22aaa6ac]{font-size:20px;line-height:1.4}.ticket-content[data-v-22aaa6ac]{flex:1;min-width:0;max-width:100%;overflow:hidden}.ticket-title[data-v-22aaa6ac]{display:block;font-weight:500;color:var(--color-main-text);margin-bottom:4px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ticket-ref[data-v-22aaa6ac]{color:var(--color-text-maxcontrast);font-weight:600}.ticket-meta[data-v-22aaa6ac]{font-size:12px;color:var(--color-text-maxcontrast);display:flex;gap:6px;flex-wrap:wrap}.ticket-meta span[data-v-22aaa6ac]{white-space:nowrap}.priority-critical[data-v-22aaa6ac]{color:#bf2600;font-weight:600}.priority-high[data-v-22aaa6ac]{color:#ff8b00;font-weight:600}.priority-medium[data-v-22aaa6ac]{color:#ffab00;font-weight:600}.priority-low[data-v-22aaa6ac]{color:#36b37e;font-weight:600}.itop-empty[data-v-22aaa6ac]{padding:20px;text-align:center;color:var(--color-text-maxcontrast);background:var(--color-background-hover);border-radius:8px}.itop-btn[data-v-22aaa6ac]{padding:10px 5px;border-radius:6px;font-size:15px;font-weight:500;margin:3px;text-decoration:none;text-align:center;cursor:pointer;border:1px solid var(--color-border);transition:all .2s;display:flex;align-items:center;justify-content:center;flex:1}.itop-btn-primary[data-v-22aaa6ac]{background:var(--color-primary-element);color:var(--color-primary-text);border-color:var(--color-primary-element)}.itop-btn-primary[data-v-22aaa6ac]:hover{background:var(--color-primary-element-hover)}.itop-btn-secondary[data-v-22aaa6ac]{background:var(--color-main-background);color:var(--color-main-text)}.itop-btn-secondary[data-v-22aaa6ac]:hover{background:var(--color-background-hover)}@media (max-width: 480px){.itop-dashboard[data-v-22aaa6ac]{padding:8px}.itop-ticket-item[data-v-22aaa6ac]{gap:8px;padding:8px 12px}.ticket-meta[data-v-22aaa6ac]{flex-direction:column;gap:4px;align-items:flex-start}.itop-actions[data-v-22aaa6ac]{flex-direction:column;gap:8px}.itop-btn[data-v-22aaa6ac],.itop-btn-refresh[data-v-22aaa6ac],.itop-btn-new-ticket[data-v-22aaa6ac]{width:100%;justify-content:center}}@media (min-width: 481px) and (max-width: 768px){.itop-actions[data-v-22aaa6ac]{flex-wrap:wrap;gap:8px}.ticket-meta[data-v-22aaa6ac]{gap:8px}}.itop-header-compact-clickable[data-v-22aaa6ac]{cursor:pointer;border-radius:4px;transition:background .2s ease;padding:4px 4px 5px;margin:0}.itop-header-compact-clickable[data-v-22aaa6ac]:hover{background:var(--color-primary-light);color:var(--color-primary-element)}")),document.head.appendChild(a)}}catch(t){console.error("vite-plugin-css-injected-by-js",t)}})();
/*! third party licenses: js/vendor.LICENSE.txt */
import{_ as c,c as p}from"./index-C7NxNLNc.chunk.mjs";import{n as l}from"./_plugin-vue2_normalizer-9Vl1xU4X.chunk.mjs";import"./translation-DoG5ZELJ-MkSmvFNE.chunk.mjs";import"./index-vg7q3Iku.chunk.mjs";const d={name:"DashboardWidget",props:{title:{type:String,default:""}},data(){return{loading:!0,refreshing:!1,error:"",counts:{},byStatus:{},tickets:{},itopUrl:"",displayName:this.title||"iTop"}},computed:{totalTickets(){const t=this.byStatus.open||0,i=this.byStatus.escalated||0,e=this.byStatus.pending||0,s=this.byStatus.resolved||0;return t+i+e+s},recentTickets(){const t=[];return["open","escalated","pending","resolved"].forEach(i=>{this.tickets[i]&&t.push(...this.tickets[i])}),t.sort((i,e)=>{const s=i.last_update||i.start_date||"";return(e.last_update||e.start_date||"").localeCompare(s)}),t.slice(0,4)},viewAllUrl(){const t=this.getItopUrl();return t?"".concat(t,"/pages/UI.php"):"#"},newTicketUrl(){const t=this.getItopUrl();return t?"".concat(t,"/pages/exec.php/browse/services?exec_module=itop-portal-base&exec_page=index.php&portal_id=itop-portal"):"#"}},mounted(){this.refresh()},methods:{iconPath(t){return window.location.origin+"/apps/integration_itop/img/"+t},getTicketIcon(t){const i=(t.status||"").toLowerCase(),e=t.type==="Incident",s=e?"incident":"user-request";return i==="closed"||i==="resolved"?this.iconPath("".concat(s,"-closed.svg")):i.includes("escalated")?this.iconPath("".concat(s,"-escalated.svg")):i==="pending"||i.includes("deadline")?this.iconPath("".concat(s,"-deadline.svg")):e&&i==="new"?this.iconPath("incident-red.svg"):this.iconPath("".concat(s,".svg"))},async refresh(){var t,i;if(!this.refreshing)try{this.refreshing=!0,this.loading||(this.loading=!0);const e=c("/apps/integration_itop/dashboard"),s=(await p.get(e)).data||{};if(s.error)throw new Error(s.error);Object.keys(s.counts||{}).forEach(a=>{this.$set(this.counts,a,s.counts[a])}),Object.keys(s.stats&&s.stats.by_status||{}).forEach(a=>{this.$set(this.byStatus,a,s.stats.by_status[a])}),Object.keys(s.tickets||{}).forEach(a=>{this.$set(this.tickets,a,s.tickets[a])}),this.itopUrl=s.itop_url||"",this.displayName=s.display_name||this.title||"iTop",this.error="",this.loading=!1}catch(e){this.error=((i=(t=e.response)==null?void 0:t.data)==null?void 0:i.error)||this.t("integration_itop","Failed to refresh dashboard"),this.loading=!1}finally{this.refreshing=!1}},priorityLevel(t){if(!t)return"low";const i=t.toLowerCase();return i.includes("critical")||i==="4"?"critical":i.includes("high")||i==="3"?"high":i.includes("medium")||i==="2"?"medium":"low"},getStatusEmoji(t){const i=(t||"").toLowerCase();return i==="new"?"üÜï":i==="assigned"?"üë•":i==="pending"?"‚è≥":i==="escalated_tto"||i==="escalated_ttr"?"‚ö†Ô∏è":i==="resolved"?"‚úÖ":i==="closed"?"‚òëÔ∏è":i==="waiting_for_approval"?"‚è≥":i==="approved"?"‚úÖ":i==="rejected"?"‚ùå":"‚ö™"},getPriorityEmoji(t){if(!t)return"üîµ";const i=String(t).toLowerCase();return i.includes("1")||i.includes("critical")?"üî¥":i.includes("2")||i.includes("high")?"üü†":i.includes("3")||i.includes("medium")?"üü°":i.includes("4")||i.includes("low")?"üü¢":"‚ö™"},getStatusLabel(t){const i=(t||"").toLowerCase();return i==="new"?this.t("integration_itop","New"):i==="assigned"?this.t("integration_itop","Assigned"):i==="ongoing"?this.t("integration_itop","Ongoing"):i==="pending"?this.t("integration_itop","Pending"):i==="escalated_tto"?this.t("integration_itop","Escalated TTO"):i==="escalated_ttr"?this.t("integration_itop","Escalated TTR"):i==="resolved"?this.t("integration_itop","Resolved"):i==="closed"?this.t("integration_itop","Closed"):i==="waiting_for_approval"?this.t("integration_itop","Waiting for approval"):i==="approved"?this.t("integration_itop","Approved"):i==="rejected"?this.t("integration_itop","Rejected"):t||this.t("integration_itop","Unknown")},getPriorityLabel(t){if(!t)return this.t("integration_itop","Unknown priority");const i=String(t).toLowerCase();return i.includes("1")||i.includes("critical")?this.t("integration_itop","Priority 1 - Critical"):i.includes("2")||i.includes("high")?this.t("integration_itop","Priority 2 - High"):i.includes("3")||i.includes("medium")?this.t("integration_itop","Priority 3 - Medium"):i.includes("4")||i.includes("low")?this.t("integration_itop","Priority 4 - Low"):this.t("integration_itop","Priority")+" "+t},getTicketTooltip(t){const i=t.ref||this.t("integration_itop","N/A"),e=t.start_date||this.t("integration_itop","N/A"),s=t.last_update||this.t("integration_itop","N/A"),a=t.title||this.t("integration_itop","Untitled ticket");let o=t.description||this.t("integration_itop","No description");return o=o.replace(/<br\s*\/?>/gi,"\n").replace(/<\/p>/gi,"\n").replace(/<p[^>]*>/gi,"").replace(/<[^>]+>/g,"").trim(),"".concat(this.t("integration_itop","Ticket:")," ").concat(i,"\n").concat(this.t("integration_itop","Created:")," ").concat(e,"\n").concat(this.t("integration_itop","Updated:")," ").concat(s,"\n-------------------\n").concat(this.t("integration_itop","Title:")," ").concat(a,"\n").concat(this.t("integration_itop","Description:"),"\n").concat(o)},formatRelativeTime(t){if(!t)return"";try{const i=new Date(t),e=new Date-i,s=Math.floor(e/1e3),a=Math.floor(s/60),o=Math.floor(a/60),n=Math.floor(o/24),r=Math.floor(n/7);return s<60?this.t("integration_itop","just now"):a===1?this.t("integration_itop","1 min ago"):a<60?"".concat(a," ").concat(this.t("integration_itop","min ago")):o===1?this.t("integration_itop","1 hour ago"):o<24?"".concat(o," ").concat(this.t("integration_itop","hours ago")):n===1?this.t("integration_itop","1 day ago"):n<7?"".concat(n," ").concat(this.t("integration_itop","days ago")):r===1?this.t("integration_itop","1 week ago"):r<4?"".concat(r," ").concat(this.t("integration_itop","weeks ago")):i.toLocaleDateString()}catch(i){return t}},getItopUrl(){return this.itopUrl||""},openSearch(){const t=document.querySelector('input[type="search"].unified-search__input');t&&t.focus()},openTicket(t){t&&window.open(t,"_blank","noopener,noreferrer")},openPortalTickets(){if(this.itopUrl){const t="".concat(this.itopUrl,"/pages/exec.php/manage/ongoing-tickets-for-portal-user?exec_module=itop-portal-base&exec_page=index.php&portal_id=itop-portal");window.open(t,"_blank","noopener,noreferrer")}}}};var _=function(){var t=this,i=t._self._c;return i("div",{ref:"dashboard",staticClass:"itop-dashboard",attrs:{role:"region","aria-label":t.t("integration_itop","Dashboard")}},[t.loading?i("div",{staticClass:"itop-dashboard__loading"},[i("div",{staticClass:"loading-spinner"}),i("p",[t._v(t._s(t.t("integration_itop","Loading dashboard...")))])]):t.error?i("div",{staticClass:"itop-dashboard__error"},[i("p",[t._v(t._s(t.error))]),i("button",{staticClass:"itop-btn",on:{click:t.refresh}},[t._v(" "+t._s(t.t("integration_itop","Retry"))+" ")])]):i("div",{staticClass:"itop-dashboard__content"},[t.totalTickets>0?[i("div",{staticClass:"itop-header-compact itop-header-compact-clickable",on:{click:t.openPortalTickets}},[i("h3",{staticClass:"itop-header-compact__title"},[t._v(" "+t._s(t.totalTickets)+" "+t._s(t.t("integration_itop",t.totalTickets===1?"Ticket":"Tickets"))+" ")]),i("div",{staticClass:"itop-status-badges"},[t.byStatus.open?i("span",{staticClass:"status-badge status-open"},[t._v(" "+t._s(t.byStatus.open)+" "+t._s(t.t("integration_itop","Open"))+" ")]):t._e(),t.byStatus.escalated?i("span",{staticClass:"status-badge status-escalated"},[t._v(" "+t._s(t.byStatus.escalated)+" "+t._s(t.t("integration_itop","Escalated"))+" ")]):t._e(),t.byStatus.pending?i("span",{staticClass:"status-badge status-pending"},[t._v(" "+t._s(t.byStatus.pending)+" "+t._s(t.t("integration_itop","Pending"))+" ")]):t._e(),t.byStatus.resolved?i("span",{staticClass:"status-badge status-resolved"},[t._v(" "+t._s(t.byStatus.resolved)+" "+t._s(t.t("integration_itop","Resolved"))+" ")]):t._e()])]),t.recentTickets.length===0?i("div",{staticClass:"itop-empty"},[t._v(" "+t._s(t.t("integration_itop","No recent tickets"))+" ")]):i("div",{staticClass:"itop-ticket-list"},t._l(t.recentTickets,function(e){return i("div",{key:e.type+"-"+e.id,staticClass:"itop-ticket-item",on:{click:function(s){return t.openTicket(e.url)}}},[i("img",{staticClass:"ticket-svg",attrs:{src:t.getTicketIcon(e),alt:""}}),i("div",{staticClass:"ticket-content"},[i("div",{staticClass:"ticket-title",attrs:{title:t.getTicketTooltip(e)}},[i("span",{staticClass:"ticket-emoji",attrs:{title:t.getStatusLabel(e.status)}},[t._v(t._s(t.getStatusEmoji(e.status)))]),e.ref?i("span",{staticClass:"ticket-ref"},[t._v(t._s(e.ref)+":")]):t._e(),t._v(" "+t._s(e.title||t.t("integration_itop","Untitled ticket"))+" ")]),i("div",{staticClass:"ticket-meta"},[i("span",{staticClass:"ticket-status"},[t._v(t._s(t.getStatusLabel(e.operational_status||e.status)))]),i("span",{staticClass:"ticket-meta-separator"},[t._v("‚Ä¢")]),i("span",{staticClass:"ticket-priority-emoji",attrs:{title:t.getPriorityLabel(e.priority)}},[t._v(t._s(t.getPriorityEmoji(e.priority)))]),e.last_update?i("span",{staticClass:"ticket-meta-separator"},[t._v("‚Ä¢")]):t._e(),e.last_update?i("span",{staticClass:"ticket-time",attrs:{title:t.t("integration_itop","Last updated: ")+e.last_update}},[t._v(" üïê "+t._s(t.formatRelativeTime(e.last_update))+" ")]):t._e()])])])}),0)]:t.totalTickets===0&&!t.loading?i("div",{staticClass:"itop-empty-state"},[i("div",{staticClass:"itop-empty-state__icon"},[i("img",{staticClass:"empty-state-svg",attrs:{src:t.iconPath("ticket.svg"),alt:""}})]),i("h3",[t._v(t._s(t.t("integration_itop","No tickets found")))]),i("p",[t._v(t._s(t.t("integration_itop","You have no open tickets at the moment")))])]):t._e(),i("div",{staticClass:"itop-actions"},[i("button",{staticClass:"itop-btn itop-btn-refresh",attrs:{disabled:t.refreshing},on:{click:t.refresh}},[t.refreshing?i("span",{staticClass:"spinner"},[t._v("‚Üª")]):i("span",[t._v("‚Üª")]),t._v(" "+t._s(t.t("integration_itop","Refresh"))+" ")]),i("a",{staticClass:"itop-btn itop-btn-new-ticket",attrs:{href:t.newTicketUrl,target:"_blank",rel:"noopener noreferrer"}},[i("span",[t._v("+")]),t._v(" "+t._s(t.t("integration_itop","New Ticket"))+" ")])])],2)])},g=[],u=l(d,_,g,!1,null,"22aaa6ac");const f=u.exports;export{f as default};
//# sourceMappingURL=DashboardWidget-PbEDZGVL.chunk.mjs.map
