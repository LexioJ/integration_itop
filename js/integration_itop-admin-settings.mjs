/*! third party licenses: js/vendor.LICENSE.txt */
(function(){const a=window.t||function(t,e){return e};document.addEventListener("DOMContentLoaded",function(){v();const t=document.getElementById("version-current");t&&(t.textContent.replace("v",""),L());const e=document.getElementById("itop-instance-url");e&&e.value.trim()!==""&&setTimeout(()=>h(!0),1e3),y()});function v(){const t=document.getElementById("save-itop-config"),e=document.getElementById("test-connection"),o=document.getElementById("test-application-token"),n=document.getElementById("itop-instance-url"),i=document.getElementById("itop-user-facing-name"),u=document.getElementById("itop-application-token");t&&t.addEventListener("click",function(c){c.preventDefault(),f()}),e&&e.addEventListener("click",function(c){c.preventDefault(),h()}),o&&o.addEventListener("click",function(c){c.preventDefault(),E()}),n&&e&&n.addEventListener("input",function(){e.disabled=!n.value.trim()}),u&&o&&u.addEventListener("input",function(){o.disabled=!u.value.trim()}),[n,i,u].forEach(c=>{c&&c.addEventListener("keypress",function(g){g.key==="Enter"&&(g.preventDefault(),f())})});const d=document.getElementById("save-cache-settings"),m=document.getElementById("clear-all-cache");d&&d.addEventListener("click",function(c){c.preventDefault(),_()}),m&&m.addEventListener("click",function(c){c.preventDefault(),k()});const p=document.getElementById("save-ci-classes"),r=document.getElementById("toggle-all-ci-classes");p&&p.addEventListener("click",function(c){c.preventDefault(),T()}),r&&r.addEventListener("click",function(c){c.preventDefault(),C()}),document.querySelectorAll(".state-button").forEach(function(c){c.addEventListener("click",function(g){g.preventDefault();const l=c.closest(".state-toggle-group");l&&(l.querySelectorAll(".state-button").forEach(function(I){I.classList.remove("active")}),c.classList.add("active"))})})}function y(){fetch(OC.generateUrl("/apps/integration_itop/connected-users-count"),{method:"GET",headers:{requesttoken:OC.requestToken}}).then(t=>t.json()).then(t=>{const e=document.getElementById("connected-users-count");e&&t.count!==void 0&&(e.textContent=t.count+" "+a("integration_itop","users"))}).catch(()=>{})}function f(){const t=document.getElementById("itop-instance-url"),e=document.getElementById("itop-user-facing-name"),o=document.getElementById("itop-application-token"),n=document.getElementById("save-itop-config"),i=t.value.trim(),u=e.value.trim(),d=o.value.trim();if(!i&&!u&&!d){s(a("integration_itop","Please enter at least a URL, display name, or application token"),!0);return}if(i)try{if(!new URL(i).protocol)throw new Error("Invalid URL")}catch(r){s(a("integration_itop","Please enter a valid URL"),!0);return}if(u.length>100){s(a("integration_itop","Display name is too long (max 100 characters)"),!0);return}n.disabled=!0;const m=n.innerHTML;n.innerHTML='<span class="btn-icon">‚è≥</span> '+a("integration_itop","Saving...");const p={values:{}};i&&(p.values.admin_instance_url=i),u&&(p.values.user_facing_name=u),d&&d!=="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"&&(p.values.application_token=d),fetch(OC.generateUrl("/apps/integration_itop/admin-config"),{method:"PUT",headers:{"Content-Type":"application/json",requesttoken:OC.requestToken},body:JSON.stringify(p)}).then(r=>{if(!r.ok)throw new Error("Server error: "+r.status);return r.json()}).then(r=>{const c=document.getElementById("current-url"),g=document.getElementById("current-name");if(r.admin_instance_url!==void 0&&c&&(c.textContent=r.admin_instance_url||a("integration_itop","Not configured")),r.user_facing_name!==void 0&&g&&(g.textContent=r.user_facing_name),r.has_application_token!==void 0&&o){o.value="",o.placeholder=r.has_application_token?"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢  "+a("integration_itop","(Configuration is saved - enter new token to update)"):a("integration_itop","Paste your personal token here");const l=document.getElementById("test-application-token");l&&(l.disabled=!0)}s(a("integration_itop","Configuration saved successfully"),!1)}).catch(()=>{s(a("integration_itop","Error saving configuration"),!0)}).finally(()=>{n.disabled=!1,n.innerHTML=m})}function h(t=!1){const e=document.getElementById("test-connection"),o=document.getElementById("connection-status"),n=document.querySelector(".connection-status"),i=document.getElementById("itop-instance-url");if(!o||!i)return;const u=i.value.trim();if(!u){t||s(a("integration_itop","Please enter a server URL"),!0);return}const d=o.dataset.textTesting||"Testing...",m=o.dataset.textConnected||"Connected",p=o.dataset.textError||"Error",r=o.dataset.textFailed||"Connection failed",c=e&&e.dataset.textTest||"Test Connection",g=e&&e.dataset.textTesting||"Testing...";e&&(e.disabled=!0,e.innerHTML='<span class="btn-icon">‚è≥</span> '+g),o.textContent=d,n&&(n.className="status-card connection-status testing"),fetch(OC.generateUrl("/apps/integration_itop/admin-config/test"),{method:"POST",headers:{"Content-Type":"application/json",requesttoken:OC.requestToken},body:JSON.stringify({url:u})}).then(l=>l.json()).then(l=>{l.status==="success"?(o.textContent="‚úÖ "+m,n&&(n.className="status-card connection-status success"),t||s(m,!1)):(o.textContent="‚ùå "+(l.message||r),n&&(n.className="status-card connection-status error"),t||s(l.message||r,!0))}).catch(()=>{o.textContent="‚ùå "+p,n&&(n.className="status-card connection-status error"),t||s(r,!0)}).finally(()=>{e&&(e.disabled=!1,e.innerHTML='<span class="btn-icon">üîç</span> '+c)})}function E(){const t=document.getElementById("itop-application-token"),e=document.getElementById("test-application-token");if(!t||!e)return;const o=t.value.trim();if(!o){s(a("integration_itop","Please enter a token"),!0);return}e.disabled=!0;const n=e.innerHTML;e.innerHTML='<span class="btn-icon">‚è≥</span> '+a("integration_itop","Testing..."),fetch(OC.generateUrl("/apps/integration_itop/admin-config/test-token"),{method:"POST",headers:{"Content-Type":"application/json",requesttoken:OC.requestToken},body:JSON.stringify({token:o})}).then(i=>i.json()).then(i=>{i.status==="success"?s(a("integration_itop","Token is valid"),!1):s(i.message||a("integration_itop","Token test failed"),!0)}).catch(()=>{s(a("integration_itop","Token test failed"),!0)}).finally(()=>{e.disabled=!1,e.innerHTML=n})}function _(){const t=document.getElementById("save-cache-settings"),e={cache_ttl_ci_preview:document.getElementById("cache-ttl-ci-preview").value,cache_ttl_ticket_info:document.getElementById("cache-ttl-ticket-info").value,cache_ttl_search:document.getElementById("cache-ttl-search").value,cache_ttl_picker:document.getElementById("cache-ttl-picker").value,cache_ttl_profile:document.getElementById("cache-ttl-profile").value};t.disabled=!0;const o=t.innerHTML;t.innerHTML='<span class="btn-icon">‚è≥</span> '+a("integration_itop","Saving..."),fetch(OC.generateUrl("/apps/integration_itop/admin-config"),{method:"PUT",headers:{"Content-Type":"application/json",requesttoken:OC.requestToken},body:JSON.stringify({values:e})}).then(n=>{if(!n.ok)throw new Error("Server error");return n.json()}).then(n=>{s(a("integration_itop","Cache settings saved"),!1)}).catch(()=>{s(a("integration_itop","Error saving cache settings"),!0)}).finally(()=>{t.disabled=!1,t.innerHTML=o})}function k(){if(!confirm(a("integration_itop","Are you sure you want to clear all cached data?")))return;const t=document.getElementById("clear-all-cache");t.disabled=!0;const e=t.innerHTML;t.innerHTML='<span class="btn-icon">‚è≥</span> '+a("integration_itop","Clearing..."),fetch(OC.generateUrl("/apps/integration_itop/clear-cache"),{method:"DELETE",headers:{requesttoken:OC.requestToken}}).then(o=>o.json()).then(o=>{s(a("integration_itop","Cache cleared successfully"),!1)}).catch(()=>{s(a("integration_itop","Error clearing cache"),!0)}).finally(()=>{t.disabled=!1,t.innerHTML=e})}function T(){const t=document.getElementById("save-ci-classes"),e={};document.querySelectorAll(".state-toggle-group").forEach(n=>{const i=n.dataset.class,u=n.querySelector(".state-button.active");u&&(e[i]=u.dataset.state)}),t.disabled=!0;const o=t.innerHTML;t.innerHTML='<span class="btn-icon">‚è≥</span> '+a("integration_itop","Saving..."),fetch(OC.generateUrl("/apps/integration_itop/admin-config"),{method:"PUT",headers:{"Content-Type":"application/json",requesttoken:OC.requestToken},body:JSON.stringify({values:{ci_class_config:e}})}).then(n=>{if(!n.ok)throw new Error("Server error");return n.json()}).then(n=>{s(a("integration_itop","CI class configuration saved"),!1)}).catch(()=>{s(a("integration_itop","Error saving CI class configuration"),!0)}).finally(()=>{t.disabled=!1,t.innerHTML=o})}function C(){const t=document.querySelectorAll(".state-toggle-group"),e=[];t.forEach(n=>{const i=n.querySelector(".state-button.active");i&&e.push(i.dataset.state)});let o="forced";e.every(n=>n==="forced")?o="user_choice":e.every(n=>n==="user_choice")&&(o="disabled"),t.forEach(n=>{n.querySelectorAll(".state-button").forEach(i=>{i.classList.remove("active"),i.dataset.state===o&&i.classList.add("active")})})}function L(t){fetch(OC.generateUrl("/apps/integration_itop/version-check"),{method:"GET",headers:{requesttoken:OC.requestToken}}).then(e=>e.json()).then(e=>{const o=document.getElementById("version-check-result"),n=document.getElementById("version-status-card"),i=document.getElementById("version-status-icon");e.has_update?(o&&(o.innerHTML=' ‚Üí <span style="color: #38a169;">v'+e.latest_version+" "+a("integration_itop","available")+"</span>"),n&&n.classList.add("update-available"),i&&(i.textContent="üéÅ")):o&&(o.innerHTML=' <span style="color: #38a169;">‚úì</span>')}).catch(()=>{})}function s(t,e){OC.Notification&&OC.Notification.showTemporary&&OC.Notification.showTemporary(t+(e?" ‚ùå":" ‚úÖ"))}})();
//# sourceMappingURL=integration_itop-admin-settings.mjs.map
