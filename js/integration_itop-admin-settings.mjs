/*! third party licenses: js/vendor.LICENSE.txt */
(function(){const i=window.t||function(e,t){return t};document.addEventListener("DOMContentLoaded",function(){y();const e=document.getElementById("version-current");e&&(e.textContent.replace("v",""),b());const t=document.getElementById("itop-instance-url");t&&t.value.trim()!==""&&setTimeout(()=>h(!0),1e3),E()});function y(){const e=document.getElementById("save-itop-config"),t=document.getElementById("test-connection"),o=document.getElementById("test-application-token"),n=document.getElementById("itop-instance-url"),a=document.getElementById("itop-user-facing-name"),u=document.getElementById("itop-application-token");e&&e.addEventListener("click",function(s){s.preventDefault(),f()}),t&&t.addEventListener("click",function(s){s.preventDefault(),h()}),o&&o.addEventListener("click",function(s){s.preventDefault(),_()}),n&&t&&n.addEventListener("input",function(){t.disabled=!n.value.trim()}),u&&o&&u.addEventListener("input",function(){o.disabled=!u.value.trim()}),[n,a,u].forEach(s=>{s&&s.addEventListener("keypress",function(l){l.key==="Enter"&&(l.preventDefault(),f())})});const d=document.getElementById("save-notification-settings");d&&d.addEventListener("click",function(s){s.preventDefault(),T()});const g=document.getElementById("save-cache-settings"),p=document.getElementById("clear-all-cache");g&&g.addEventListener("click",function(s){s.preventDefault(),k()}),p&&p.addEventListener("click",function(s){s.preventDefault(),C()});const r=document.getElementById("save-ci-classes"),m=document.getElementById("toggle-all-ci-classes");r&&r.addEventListener("click",function(s){s.preventDefault(),L()}),m&&m.addEventListener("click",function(s){s.preventDefault(),I()}),document.querySelectorAll(".state-button").forEach(function(s){s.addEventListener("click",function(l){l.preventDefault();const v=s.closest(".state-toggle-group");v&&(v.querySelectorAll(".state-button").forEach(function(B){B.classList.remove("active")}),s.classList.add("active"))})})}function E(){fetch(OC.generateUrl("/apps/integration_itop/admin-config"),{method:"GET",headers:{requesttoken:OC.requestToken}}).then(e=>e.json()).then(e=>{const t=document.getElementById("connected-users-count");t&&e.connected_users!==void 0&&(t.textContent=e.connected_users+" "+i("integration_itop","users"))}).catch(()=>{})}function f(){const e=document.getElementById("itop-instance-url"),t=document.getElementById("itop-user-facing-name"),o=document.getElementById("itop-application-token"),n=document.getElementById("save-itop-config"),a=e.value.trim(),u=t.value.trim(),d=o.value.trim();if(!a&&!u&&!d){c(i("integration_itop","Please enter at least a URL, display name, or application token"),!0);return}if(a)try{if(!new URL(a).protocol)throw new Error("Invalid URL")}catch(r){c(i("integration_itop","Please enter a valid URL"),!0);return}if(u.length>100){c(i("integration_itop","Display name is too long (max 100 characters)"),!0);return}n.disabled=!0;const g=n.innerHTML;n.innerHTML='<span class="btn-icon">‚è≥</span> '+i("integration_itop","Saving...");const p={values:{}};a&&(p.values.admin_instance_url=a),u&&(p.values.user_facing_name=u),d&&d!=="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"&&(p.values.application_token=d),fetch(OC.generateUrl("/apps/integration_itop/admin-config"),{method:"PUT",headers:{"Content-Type":"application/json",requesttoken:OC.requestToken},body:JSON.stringify(p)}).then(r=>{if(!r.ok)throw new Error("Server error: "+r.status);return r.json()}).then(r=>{const m=document.getElementById("current-url"),s=document.getElementById("current-name");if(r.admin_instance_url!==void 0&&m&&(m.textContent=r.admin_instance_url||i("integration_itop","Not configured")),r.user_facing_name!==void 0&&s&&(s.textContent=r.user_facing_name),r.has_application_token!==void 0&&o){o.value="",o.placeholder=r.has_application_token?"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢  "+i("integration_itop","(Configuration is saved - enter new token to update)"):i("integration_itop","Paste your personal token here");const l=document.getElementById("test-application-token");l&&(l.disabled=!0)}c(i("integration_itop","Configuration saved successfully"),!1)}).catch(()=>{c(i("integration_itop","Error saving configuration"),!0)}).finally(()=>{n.disabled=!1,n.innerHTML=g})}function h(e=!1){const t=document.getElementById("test-connection"),o=document.getElementById("connection-status"),n=document.querySelector(".connection-status"),a=document.getElementById("itop-instance-url");if(!o||!a)return;const u=a.value.trim();if(!u){e||c(i("integration_itop","Please enter a server URL"),!0);return}const d=o.dataset.textTesting||"Testing...",g=o.dataset.textConnected||"Connected",p=o.dataset.textError||"Error",r=o.dataset.textFailed||"Connection failed",m=t&&t.dataset.textTest||"Test Connection",s=t&&t.dataset.textTesting||"Testing...";t&&(t.disabled=!0,t.innerHTML='<span class="btn-icon">‚è≥</span> '+s),o.textContent=d,n&&(n.className="status-card connection-status testing"),fetch(OC.generateUrl("/apps/integration_itop/admin-config/test"),{method:"POST",headers:{"Content-Type":"application/json",requesttoken:OC.requestToken},body:JSON.stringify({url:u})}).then(l=>l.json()).then(l=>{l.status==="success"?(o.textContent="‚úÖ "+g,n&&(n.className="status-card connection-status success"),e||c(g,!1)):(o.textContent="‚ùå "+(l.message||r),n&&(n.className="status-card connection-status error"),e||c(l.message||r,!0))}).catch(()=>{o.textContent="‚ùå "+p,n&&(n.className="status-card connection-status error"),e||c(r,!0)}).finally(()=>{t&&(t.disabled=!1,t.innerHTML='<span class="btn-icon">üîç</span> '+m)})}function _(){const e=document.getElementById("itop-application-token"),t=document.getElementById("test-application-token");if(!e||!t)return;const o=e.value.trim();if(!o){c(i("integration_itop","Please enter a token"),!0);return}t.disabled=!0;const n=t.innerHTML;t.innerHTML='<span class="btn-icon">‚è≥</span> '+i("integration_itop","Testing..."),fetch(OC.generateUrl("/apps/integration_itop/admin-config/test-token"),{method:"POST",headers:{"Content-Type":"application/json",requesttoken:OC.requestToken},body:JSON.stringify({token:o})}).then(a=>a.json()).then(a=>{a.status==="success"?c(i("integration_itop","Token is valid"),!1):c(a.message||i("integration_itop","Token test failed"),!0)}).catch(()=>{c(i("integration_itop","Token test failed"),!0)}).finally(()=>{t.disabled=!1,t.innerHTML=n})}function T(){const e=document.getElementById("save-notification-settings"),t=parseInt(document.getElementById("portal-notification-interval").value);e.disabled=!0;const o=e.innerHTML;e.innerHTML='<span class="btn-icon">‚è≥</span> '+i("integration_itop","Saving..."),fetch(OC.generateUrl("/apps/integration_itop/notification-settings"),{method:"POST",headers:{"Content-Type":"application/json",requesttoken:OC.requestToken},body:JSON.stringify({portalInterval:t})}).then(n=>{if(!n.ok)throw new Error("Server error");return n.json()}).then(n=>{c(i("integration_itop","Notification settings saved"),!1)}).catch(()=>{c(i("integration_itop","Error saving notification settings"),!0)}).finally(()=>{e.disabled=!1,e.innerHTML=o})}function k(){const e=document.getElementById("save-cache-settings"),t={cache_ttl_ci_preview:document.getElementById("cache-ttl-ci-preview").value,cache_ttl_ticket_info:document.getElementById("cache-ttl-ticket-info").value,cache_ttl_search:document.getElementById("cache-ttl-search").value,cache_ttl_picker:document.getElementById("cache-ttl-picker").value,cache_ttl_profile:document.getElementById("cache-ttl-profile").value};e.disabled=!0;const o=e.innerHTML;e.innerHTML='<span class="btn-icon">‚è≥</span> '+i("integration_itop","Saving..."),fetch(OC.generateUrl("/apps/integration_itop/admin-config"),{method:"PUT",headers:{"Content-Type":"application/json",requesttoken:OC.requestToken},body:JSON.stringify({values:t})}).then(n=>{if(!n.ok)throw new Error("Server error");return n.json()}).then(n=>{c(i("integration_itop","Cache settings saved"),!1)}).catch(()=>{c(i("integration_itop","Error saving cache settings"),!0)}).finally(()=>{e.disabled=!1,e.innerHTML=o})}function C(){if(!confirm(i("integration_itop","Are you sure you want to clear all cached data?")))return;const e=document.getElementById("clear-all-cache");e.disabled=!0;const t=e.innerHTML;e.innerHTML='<span class="btn-icon">‚è≥</span> '+i("integration_itop","Clearing..."),fetch(OC.generateUrl("/apps/integration_itop/clear-cache"),{method:"DELETE",headers:{requesttoken:OC.requestToken}}).then(o=>o.json()).then(o=>{c(i("integration_itop","Cache cleared successfully"),!1)}).catch(()=>{c(i("integration_itop","Error clearing cache"),!0)}).finally(()=>{e.disabled=!1,e.innerHTML=t})}function L(){const e=document.getElementById("save-ci-classes"),t={};document.querySelectorAll(".state-toggle-group").forEach(n=>{const a=n.dataset.class,u=n.querySelector(".state-button.active");u&&(t[a]=u.dataset.state)}),e.disabled=!0;const o=e.innerHTML;e.innerHTML='<span class="btn-icon">‚è≥</span> '+i("integration_itop","Saving..."),fetch(OC.generateUrl("/apps/integration_itop/admin-config"),{method:"PUT",headers:{"Content-Type":"application/json",requesttoken:OC.requestToken},body:JSON.stringify({values:{ci_class_config:t}})}).then(n=>{if(!n.ok)throw new Error("Server error");return n.json()}).then(n=>{c(i("integration_itop","CI class configuration saved"),!1)}).catch(()=>{c(i("integration_itop","Error saving CI class configuration"),!0)}).finally(()=>{e.disabled=!1,e.innerHTML=o})}function I(){const e=document.querySelectorAll(".state-toggle-group"),t=[];e.forEach(n=>{const a=n.querySelector(".state-button.active");a&&t.push(a.dataset.state)});let o="forced";t.every(n=>n==="forced")?o="user_choice":t.every(n=>n==="user_choice")&&(o="disabled"),e.forEach(n=>{n.querySelectorAll(".state-button").forEach(a=>{a.classList.remove("active"),a.dataset.state===o&&a.classList.add("active")})})}function b(e){fetch(OC.generateUrl("/apps/integration_itop/version-check"),{method:"GET",headers:{requesttoken:OC.requestToken}}).then(t=>t.json()).then(t=>{const o=document.getElementById("version-check-result"),n=document.getElementById("version-status-card"),a=document.getElementById("version-status-icon");t.has_update?(o&&(o.innerHTML=' ‚Üí <span style="color: #38a169;">v'+t.latest_version+" "+i("integration_itop","available")+"</span>"),n&&n.classList.add("update-available"),a&&(a.textContent="üéÅ")):o&&(o.innerHTML=' <span style="color: #38a169;">‚úì</span>')}).catch(()=>{})}function c(e,t){OC.Notification&&OC.Notification.showTemporary&&OC.Notification.showTemporary(e+(t?" ‚ùå":" ‚úÖ"))}})();
//# sourceMappingURL=integration_itop-admin-settings.mjs.map
