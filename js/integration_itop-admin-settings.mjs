/*! third party licenses: js/vendor.LICENSE.txt */
(function(){const a=window.t||function(t,e){return e};document.addEventListener("DOMContentLoaded",function(){_();const t=document.getElementById("version-current");t&&(t.textContent.replace("v",""),q());const e=document.getElementById("itop-instance-url");e&&e.value.trim()!==""&&setTimeout(()=>y(!0),1e3),T()});function _(){const t=document.getElementById("save-itop-config"),e=document.getElementById("test-connection"),o=document.getElementById("test-application-token"),n=document.getElementById("itop-instance-url"),i=document.getElementById("itop-user-facing-name"),s=document.getElementById("itop-application-token");t&&t.addEventListener("click",function(c){c.preventDefault(),h()}),e&&e.addEventListener("click",function(c){c.preventDefault(),y()}),o&&o.addEventListener("click",function(c){c.preventDefault(),k()}),n&&e&&n.addEventListener("input",function(){e.disabled=!n.value.trim()}),s&&o&&s.addEventListener("input",function(){o.disabled=!s.value.trim()}),[n,i,s].forEach(c=>{c&&c.addEventListener("keypress",function(v){v.key==="Enter"&&(v.preventDefault(),h())})});const l=document.getElementById("save-notification-settings");l&&l.addEventListener("click",function(c){c.preventDefault(),C()});const d=document.getElementById("save-notification-config");d&&d.addEventListener("click",function(c){c.preventDefault(),L()});const g=document.getElementById("save-cache-settings"),u=document.getElementById("clear-all-cache");g&&g.addEventListener("click",function(c){c.preventDefault(),I()}),u&&u.addEventListener("click",function(c){c.preventDefault(),b()});const f=document.getElementById("save-ci-classes"),m=document.getElementById("toggle-all-ci-classes");f&&f.addEventListener("click",function(c){c.preventDefault(),B()}),m&&m.addEventListener("click",function(c){c.preventDefault(),S()});const p=document.getElementById("toggle-all-notifications");p&&p.addEventListener("click",function(c){c.preventDefault(),O()}),document.querySelectorAll(".state-button").forEach(function(c){c.addEventListener("click",function(v){v.preventDefault();const E=c.closest(".state-toggle-group");E&&(E.querySelectorAll(".state-button").forEach(function(M){M.classList.remove("active")}),c.classList.add("active"))})})}function T(){fetch(OC.generateUrl("/apps/integration_itop/admin-config"),{method:"GET",headers:{requesttoken:OC.requestToken}}).then(t=>t.json()).then(t=>{const e=document.getElementById("connected-users-count");e&&t.connected_users!==void 0&&(e.textContent=t.connected_users+" "+a("integration_itop","users"))}).catch(()=>{})}function h(){const t=document.getElementById("itop-instance-url"),e=document.getElementById("itop-user-facing-name"),o=document.getElementById("itop-application-token"),n=document.getElementById("save-itop-config"),i=t.value.trim(),s=e.value.trim(),l=o.value.trim();if(!i&&!s&&!l){r(a("integration_itop","Please enter at least a URL, display name, or application token"),!0);return}if(i)try{if(!new URL(i).protocol)throw new Error("Invalid URL")}catch(u){r(a("integration_itop","Please enter a valid URL"),!0);return}if(s.length>100){r(a("integration_itop","Display name is too long (max 100 characters)"),!0);return}n.disabled=!0;const d=n.innerHTML;n.innerHTML='<span class="btn-icon">‚è≥</span> '+a("integration_itop","Saving...");const g={values:{}};i&&(g.values.admin_instance_url=i),s&&(g.values.user_facing_name=s),l&&l!=="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"&&(g.values.application_token=l),fetch(OC.generateUrl("/apps/integration_itop/admin-config"),{method:"PUT",headers:{"Content-Type":"application/json",requesttoken:OC.requestToken},body:JSON.stringify(g)}).then(u=>{if(!u.ok)throw new Error("Server error: "+u.status);return u.json()}).then(u=>{const f=document.getElementById("current-url"),m=document.getElementById("current-name");if(u.admin_instance_url!==void 0&&f&&(f.textContent=u.admin_instance_url||a("integration_itop","Not configured")),u.user_facing_name!==void 0&&m&&(m.textContent=u.user_facing_name),u.has_application_token!==void 0&&o){o.value="",o.placeholder=u.has_application_token?"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢  "+a("integration_itop","(Configuration is saved - enter new token to update)"):a("integration_itop","Paste your personal token here");const p=document.getElementById("test-application-token");p&&(p.disabled=!0)}r(a("integration_itop","Configuration saved successfully"),!1)}).catch(()=>{r(a("integration_itop","Error saving configuration"),!0)}).finally(()=>{n.disabled=!1,n.innerHTML=d})}function y(t=!1){const e=document.getElementById("test-connection"),o=document.getElementById("connection-status"),n=document.querySelector(".connection-status"),i=document.getElementById("itop-instance-url");if(!o||!i)return;const s=i.value.trim();if(!s){t||r(a("integration_itop","Please enter a server URL"),!0);return}const l=o.dataset.textTesting||"Testing...",d=o.dataset.textConnected||"Connected",g=o.dataset.textError||"Error",u=o.dataset.textFailed||"Connection failed",f=e&&e.dataset.textTest||"Test Connection",m=e&&e.dataset.textTesting||"Testing...";e&&(e.disabled=!0,e.innerHTML='<span class="btn-icon">‚è≥</span> '+m),o.textContent=l,n&&(n.className="status-card connection-status testing"),fetch(OC.generateUrl("/apps/integration_itop/admin-config/test"),{method:"POST",headers:{"Content-Type":"application/json",requesttoken:OC.requestToken},body:JSON.stringify({url:s})}).then(p=>p.json()).then(p=>{p.status==="success"?(o.textContent="‚úÖ "+d,n&&(n.className="status-card connection-status success"),t||r(d,!1)):(o.textContent="‚ùå "+(p.message||u),n&&(n.className="status-card connection-status error"),t||r(p.message||u,!0))}).catch(()=>{o.textContent="‚ùå "+g,n&&(n.className="status-card connection-status error"),t||r(u,!0)}).finally(()=>{e&&(e.disabled=!1,e.innerHTML='<span class="btn-icon">üîç</span> '+f)})}function k(){const t=document.getElementById("itop-application-token"),e=document.getElementById("test-application-token");if(!t||!e)return;const o=t.value.trim();if(!o){r(a("integration_itop","Please enter a token"),!0);return}e.disabled=!0;const n=e.innerHTML;e.innerHTML='<span class="btn-icon">‚è≥</span> '+a("integration_itop","Testing..."),fetch(OC.generateUrl("/apps/integration_itop/admin-config/test-token"),{method:"POST",headers:{"Content-Type":"application/json",requesttoken:OC.requestToken},body:JSON.stringify({token:o})}).then(i=>i.json()).then(i=>{i.status==="success"?r(a("integration_itop","Token is valid"),!1):r(i.message||a("integration_itop","Token test failed"),!0)}).catch(()=>{r(a("integration_itop","Token test failed"),!0)}).finally(()=>{e.disabled=!1,e.innerHTML=n})}function C(){const t=document.getElementById("save-notification-settings"),e=parseInt(document.getElementById("portal-notification-interval").value);t.disabled=!0;const o=t.innerHTML;t.innerHTML='<span class="btn-icon">‚è≥</span> '+a("integration_itop","Saving..."),fetch(OC.generateUrl("/apps/integration_itop/notification-settings"),{method:"POST",headers:{"Content-Type":"application/json",requesttoken:OC.requestToken},body:JSON.stringify({portalInterval:e})}).then(n=>{if(!n.ok)throw new Error("Server error");return n.json()}).then(n=>{r(a("integration_itop","Notification settings saved"),!1)}).catch(()=>{r(a("integration_itop","Error saving notification settings"),!0)}).finally(()=>{t.disabled=!1,t.innerHTML=o})}function L(){const t=document.getElementById("save-notification-config"),e=parseInt(document.getElementById("default-notification-interval").value),o={};document.querySelectorAll('.state-toggle-group[data-notification-type="portal"]').forEach(s=>{const l=s.dataset.notification,d=s.querySelector(".state-button.active");d&&(o[l]=d.dataset.state)});const n={};document.querySelectorAll('.state-toggle-group[data-notification-type="agent"]').forEach(s=>{const l=s.dataset.notification,d=s.querySelector(".state-button.active");d&&(n[l]=d.dataset.state)}),t.disabled=!0;const i=t.innerHTML;t.innerHTML='<span class="btn-icon">‚è≥</span> '+a("integration_itop","Saving..."),fetch(OC.generateUrl("/apps/integration_itop/notification-config"),{method:"POST",headers:{"Content-Type":"application/json",requesttoken:OC.requestToken},body:JSON.stringify({defaultInterval:e,portalConfig:JSON.stringify(o),agentConfig:JSON.stringify(n)})}).then(s=>{if(!s.ok)throw new Error("Server error");return s.json()}).then(s=>{r(a("integration_itop","Notification configuration saved"),!1)}).catch(()=>{r(a("integration_itop","Error saving notification configuration"),!0)}).finally(()=>{t.disabled=!1,t.innerHTML=i})}function I(){const t=document.getElementById("save-cache-settings"),e={cache_ttl_ci_preview:document.getElementById("cache-ttl-ci-preview").value,cache_ttl_ticket_info:document.getElementById("cache-ttl-ticket-info").value,cache_ttl_search:document.getElementById("cache-ttl-search").value,cache_ttl_picker:document.getElementById("cache-ttl-picker").value,cache_ttl_profile:document.getElementById("cache-ttl-profile").value};t.disabled=!0;const o=t.innerHTML;t.innerHTML='<span class="btn-icon">‚è≥</span> '+a("integration_itop","Saving..."),fetch(OC.generateUrl("/apps/integration_itop/admin-config"),{method:"PUT",headers:{"Content-Type":"application/json",requesttoken:OC.requestToken},body:JSON.stringify({values:e})}).then(n=>{if(!n.ok)throw new Error("Server error");return n.json()}).then(n=>{r(a("integration_itop","Cache settings saved"),!1)}).catch(()=>{r(a("integration_itop","Error saving cache settings"),!0)}).finally(()=>{t.disabled=!1,t.innerHTML=o})}function b(){if(!confirm(a("integration_itop","Are you sure you want to clear all cached data?")))return;const t=document.getElementById("clear-all-cache");t.disabled=!0;const e=t.innerHTML;t.innerHTML='<span class="btn-icon">‚è≥</span> '+a("integration_itop","Clearing..."),fetch(OC.generateUrl("/apps/integration_itop/clear-cache"),{method:"DELETE",headers:{requesttoken:OC.requestToken}}).then(o=>o.json()).then(o=>{r(a("integration_itop","Cache cleared successfully"),!1)}).catch(()=>{r(a("integration_itop","Error clearing cache"),!0)}).finally(()=>{t.disabled=!1,t.innerHTML=e})}function B(){const t=document.getElementById("save-ci-classes"),e={};document.querySelectorAll(".state-toggle-group[data-class]").forEach(n=>{const i=n.dataset.class,s=n.querySelector(".state-button.active");s&&(e[i]=s.dataset.state)}),t.disabled=!0;const o=t.innerHTML;t.innerHTML='<span class="btn-icon">‚è≥</span> '+a("integration_itop","Saving..."),fetch(OC.generateUrl("/apps/integration_itop/ci-class-config"),{method:"POST",headers:{"Content-Type":"application/json",requesttoken:OC.requestToken},body:JSON.stringify({classConfig:e})}).then(n=>{if(!n.ok)throw new Error("Server error");return n.json()}).then(n=>{r(a("integration_itop","CI class configuration saved"),!1)}).catch(()=>{r(a("integration_itop","Error saving CI class configuration"),!0)}).finally(()=>{t.disabled=!1,t.innerHTML=o})}function S(){const t=document.querySelectorAll(".state-toggle-group[data-class]"),e=[];t.forEach(n=>{const i=n.querySelector(".state-button.active");i&&e.push(i.dataset.state)});let o="forced";e.every(n=>n==="forced")?o="user_choice":e.every(n=>n==="user_choice")&&(o="disabled"),t.forEach(n=>{n.querySelectorAll(".state-button").forEach(i=>{i.classList.remove("active"),i.dataset.state===o&&i.classList.add("active")})})}function O(){const t=document.querySelectorAll(".state-toggle-group[data-notification-type]"),e=[];t.forEach(n=>{const i=n.querySelector(".state-button.active");i&&e.push(i.dataset.state)});let o="forced";e.every(n=>n==="forced")?o="user_choice":e.every(n=>n==="user_choice")&&(o="disabled"),t.forEach(n=>{n.querySelectorAll(".state-button").forEach(i=>{i.classList.remove("active"),i.dataset.state===o&&i.classList.add("active")})})}function q(t){fetch(OC.generateUrl("/apps/integration_itop/version-check"),{method:"GET",headers:{requesttoken:OC.requestToken}}).then(e=>e.json()).then(e=>{const o=document.getElementById("version-check-result"),n=document.getElementById("version-status-card"),i=document.getElementById("version-status-icon");e.has_update?(o&&(o.innerHTML=' ‚Üí <span style="color: #38a169;">v'+e.latest_version+" "+a("integration_itop","available")+"</span>"),n&&n.classList.add("update-available"),i&&(i.textContent="üéÅ")):o&&(o.innerHTML=' <span style="color: #38a169;">‚úì</span>')}).catch(()=>{})}function r(t,e){OC.Notification&&OC.Notification.showTemporary&&OC.Notification.showTemporary(t+(e?" ‚ùå":" ‚úÖ"))}})();
//# sourceMappingURL=integration_itop-admin-settings.mjs.map
